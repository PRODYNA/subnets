<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">

<head>
  <title>Subnet Calculator</title>

  <link rel="stylesheet" href="subnets.css">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono&display=swap" rel="stylesheet">

  <script language="javascript" type="text/javascript">
    var visibleColumns = {
      subnet: true,
      netmask: false,
      range: true,
      useable: true,
      hosts: true,
      divide: true,
      join: true,
    };

    var curNetwork = 0;
    var curMask = 0;

    function updateNetwork() {
      var newNetworkStr = document.forms['calc'].elements['network'].value;
      var newMask = parseInt(document.forms['calc'].elements['netbits'].value);

      var newNetwork = inet_aton(newNetworkStr);

      if (newNetwork === null) {
        alert('Invalid network address entered');
        return;
      }

      var tmpNetwork = network_address(newNetwork, newMask);
      if (newNetwork != tmpNetwork) {
        alert('The network address entered is not on a network boundary for this mask.\nIt has been changed to ' + inet_ntoa(tmpNetwork) + '.');
        newNetwork = tmpNetwork;
        document.forms['calc'].elements['network'].value = inet_ntoa(tmpNetwork);
      }

      if (newMask < 0 || newMask > 32) {
        alert('The network mask you have entered is invalid');
        return;
      }

      if (curMask == 0) {
        curMask = newMask;
        curNetwork = newNetwork;
        startOver();
      }
      else if (curMask != newMask && confirm('You are changing the base network from /' + curMask + ' to /' + newMask + '. This will reset any changes you have made. Proceed?')) {
        curMask = newMask;
        curNetwork = newNetwork;

        startOver();
      }
      else {
        document.forms['calc'].elements['netbits'].value = curMask;
        curNetwork = newNetwork;

        recreateTables();
      }
    }

    function startOver() {
      rootSubnet = [0, 0, null];

      recreateTables();
    }

    function recreateTables() {
      // Update header visibility
      for (const name in visibleColumns) {
        console.log(name)
        document.getElementById(name + 'Header').style.display = visibleColumns[name] ? 'table-cell' : 'none';
      }

      var calcbody = document.getElementById('calcbody');
      if (!calcbody) {
        alert('Body not found');
        return;
      }

      while (calcbody.hasChildNodes()) {
        calcbody.removeChild(calcbody.firstChild);
      }

      updateNumChildren(rootSubnet);
      updateDepthChildren(rootSubnet);

      createRow(calcbody, rootSubnet, curNetwork, curMask, [curMask, rootSubnet[1], rootSubnet], rootSubnet[0]);

      document.getElementById('joinHeader').colSpan = (rootSubnet[0] > 0 ? rootSubnet[0] : 1);

      /* Create the bookmark hyperlink */
      var link = document.getElementById('saveLink');
      if (link) {
        link.href = 'subnets.html?network=' + inet_ntoa(curNetwork) + '&mask=' + curMask + '&division=' + binToAscii(nodeToString(rootSubnet));
      }
    }

    function nodeToString(node) {
      if (node[2]) {
        return '1' + nodeToString(node[2][0]) + nodeToString(node[2][1]);
      }
      else {
        return '0';
      }
    }

    function binToAscii(str) {
      var curOut = '';
      var curBit = 0;
      var curChar = 0;

      for (var i = 0; i < str.length; i++) {
        if (str.charAt(i) == '1') {
          curChar |= 1 << curBit;
        }
        curBit++;
        if (curBit > 3) {
          curOut += curChar.toString(16);
          curChar = 0;
          curBit = 0;
        }
      }
      if (curBit > 0) {
        curOut += curChar.toString(16);
      }
      return str.length + '.' + curOut;
    }

    function asciiToBin(str) {
      var re = /([0-9]+)\.([0-9a-f]+)/;
      var res = re.exec(str);
      var len = res[1];
      var encoded = res[2];
      var out = '';
      for (var i = 0; i < res[1]; i++) {
        var ch = parseInt(res[2].charAt(Math.floor(i / 4)), 16);
        var pos = i % 4;
        out += (ch & (1 << pos) ? '1' : '0');
      }
      return out;
    }

    function createRow(calcbody, node, address, mask, labels, depth) {
      if (node[2]) {
        var newlabels = labels;
        newlabels.push(mask + 1);
        newlabels.push(node[2][0][1]);
        newlabels.push(node[2][0]);
        createRow(calcbody, node[2][0], address, mask + 1, newlabels, depth - 1);

        newlabels = new Array();
        newlabels.push(mask + 1);
        newlabels.push(node[2][1][1]);
        newlabels.push(node[2][1]);
        createRow(calcbody, node[2][1], address + subnet_addresses(mask + 1), mask + 1, newlabels, depth - 1);
      }
      else {
        var newRow = document.createElement('TR');
        calcbody.appendChild(newRow);

        /* subnet address */
        if (visibleColumns.subnet) {
          var newCell = document.createElement('TD');
          newCell.appendChild(document.createTextNode(inet_ntoa(address) + '/' + mask));
          newRow.appendChild(newCell);
        }

        var addressFirst = address;
        var addressLast = subnet_last_address(address, mask);
        var useableFirst = address + 1;
        var useableLast = addressLast - 1;
        var numHosts;
        var addressRange;
        var usaebleRange;

        if (mask == 32) {
          addressRange = inet_ntoa(addressFirst);
          useableRange = addressRange;
          numHosts = 1;
        }
        else {
          addressRange = inet_ntoa(addressFirst) + ' - ' + inet_ntoa(addressLast);
          if (mask == 31) {
            useableRange = addressRange;
            numHosts = 2;
          }
          else {
            useableRange = inet_ntoa(useableFirst) + ' - ' + inet_ntoa(useableLast);
            numHosts = (1 + useableLast - useableFirst);
          }
        }

        /* netmask */
        if (visibleColumns.netmask) {
          var newCell = document.createElement('TD');
          newCell.appendChild(document.createTextNode(inet_ntoa(subnet_netmask(mask))));
          newRow.appendChild(newCell);
        }

        /* range of addresses */
        if (visibleColumns.range) {
          var newCell = document.createElement('TD');
          newCell.appendChild(document.createTextNode(addressRange));
          newRow.appendChild(newCell);
        }

        /* useable addresses */
        if (visibleColumns.useable) {
          var newCell = document.createElement('TD');
          newCell.appendChild(document.createTextNode(useableRange));
          newRow.appendChild(newCell);
        }

        /* Hosts */
        if (visibleColumns.hosts) {
          var newCell = document.createElement('TD');
          newCell.appendChild(document.createTextNode(numHosts));
          newRow.appendChild(newCell);
        }

        /* actions */

        if (visibleColumns.divide) {
          var newCell = document.createElement('TD');
          newRow.appendChild(newCell);

          newCell.classList.add('hiddenFromCopy');

          if (mask == 32) {
            var newLink = document.createElement('SPAN');
            newLink.className = 'disabledAction';
            newLink.appendChild(document.createTextNode('Divide'));
            newCell.appendChild(newLink);
          }
          else {
            var newLink = document.createElement('A');
            newLink.href = '#';
            newLink.onclick = function () { divide(node); return false; }
            newLink.appendChild(document.createTextNode('Divide'));
            newCell.appendChild(newLink);
          }
        }

        if (visibleColumns.join) {
          var colspan = depth - node[0];

          for (var i = (labels.length / 3) - 1; i >= 0; i--) {
            var mask = labels[i * 3];
            var rowspan = labels[(i * 3) + 1];
            var joinnode = labels[(i * 3) + 2];

            var newCell = document.createElement('TD');
            newCell.rowSpan = (rowspan > 1 ? rowspan : 1);
            newCell.colSpan = (colspan > 1 ? colspan : 1);

            newCell.classList.add('hiddenFromCopy');

            if (i == (labels.length / 3) - 1) {
              newCell.classList.add('maskSpan');
            }
            else {
              newCell.classList.add('maskSpanJoinable');
              newCell.onclick = newJoin(joinnode);
            }

            var newSpan = document.createElement('SPAN');
            newSpan.innerHTML = '/' + mask;
            newSpan.classList.add('global-mask');
            newCell.appendChild(newSpan);
            newRow.appendChild(newCell);

            colspan = 1; // reset for subsequent cells
          }
        }
      }

    }

    /* This is necessary because 'joinnode' changes during the scope of the caller */
    function newJoin(joinnode) {
      return function () { join(joinnode) };
    }

    function divide(node) {
      node[2] = new Array();
      node[2][0] = [0, 0, null];
      node[2][1] = [0, 0, null];
      recreateTables();
    }

    function join(node) {
      /* easy as pie */
      node[2] = null;
      recreateTables();
    }

    function updateNumChildren(node) {
      if (node[2] == null) {
        node[1] = 0;
        return 1;
      }
      else {
        node[1] = updateNumChildren(node[2][0]) + updateNumChildren(node[2][1]);
        return node[1];
      }
    }

    function updateDepthChildren(node) {
      if (node[2] == null) {
        node[0] = 0;
        return 1;
      }
      else {
        node[0] = updateDepthChildren(node[2][0]) + updateDepthChildren(node[2][1]);
        return node[1];
      }
    }


    var rootSubnet;

    // each node is Array:
    // [0] => depth of children, total number of visible children, children


    function inet_ntoa(addrint) {
      return ((addrint >> 24) & 0xff) + '.' +
        ((addrint >> 16) & 0xff) + '.' +
        ((addrint >> 8) & 0xff) + '.' +
        (addrint & 0xff);
    }

    function inet_aton(addrstr) {
      var re = /^([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/;
      var res = re.exec(addrstr);

      if (res === null) {
        return null;
      }

      for (var i = 1; i <= 4; i++) {
        if (res[i] < 0 || res[i] > 255) {
          return null;
        }
      }

      return (res[1] << 24) | (res[2] << 16) | (res[3] << 8) | res[4];
    }

    function network_address(ip, mask) {
      var maskbits = 0;
      for (var i = 31 - mask; i >= 0; i--) {
        ip &= ~1 << i;
      }
      return ip;
    }

    function subnet_addresses(mask) {
      return 2 ** (32 - mask);
    }

    function subnet_last_address(subnet, mask) {
      return subnet + subnet_addresses(mask) - 1;
    }

    function subnet_netmask(mask) {
      return network_address(0xffffffff, mask);
    }

    function calcOnLoad() {
      args = parseQueryString();
      if (args['network'] && args['mask'] && args['division']) {
        document.forms['calc'].elements['network'].value = args['network'];
        document.forms['calc'].elements['netbits'].value = args['mask'];
        updateNetwork();
        var division = asciiToBin(args['division']);
        rootSubnet = [0, 0, null];
        if (division != '0') {
          loadNode(rootSubnet, division);
        }
        recreateTables();
      }
      else {
        updateNetwork();
      }
    }

    function loadNode(curNode, division) {
      if (division.charAt(0) == '0') {
        return division.substr(1);
      }
      else {
        curNode[2] = new Array();
        curNode[2][0] = [0, 0, null];
        curNode[2][1] = [0, 0, null];

        division = loadNode(curNode[2][0], division.substr(1));
        division = loadNode(curNode[2][1], division);
        return division;
      }
    }


    function parseQueryString(str) {
      str = str ? str : location.search;
      var query = str.charAt(0) == '?' ? str.substring(1) : str;
      var args = new Object();
      if (query) {
        var fields = query.split('&');
        for (var f = 0; f < fields.length; f++) {
          var field = fields[f].split('=');
          args[unescape(field[0].replace(/\+/g, ' '))] =
            unescape(field[1].replace(/\+/g, ' '));
        }
      }
      return args;
    }

    window.onload = calcOnLoad;

    function toggleColumn(cb) {
      var colName = 'col_' + (cb.id.substr(3));
      visibleColumns[cb.id.substr(3)] = cb.checked;
      recreateTables(); /* because IE draws lines all over the place with border-collapse */
    }

  </script>

  <style type="text/css">
    H1 {
      font-family: Arial, Verdana, sans-serif;
      font-size: 18pt;
    }

    BODY {
      font-family: Arial, Verdana, sans-serif;
    }

    P {
      font-family: Arial, Verdana, sans-serif;
      font-size: 75%;
    }

    .label {
      font-family: Arial, Verdana, sans-serif;
      font-size: 60%;
    }

    .calc {
      font-family: Arial, Verdana, sans-serif;
      font-size: 80%;
      border-collapse: collapse;
    }

    .calc td,
    .calc th {
      border: 1px solid black;
    }

    .calc thead {
      font-weight: bold;
      background-color: #eeeeee;
    }

    .disabledAction {
      color: #dddddd;
    }

    .maskSpan {
      background-color: #cccccc;
      text-align: right;
    }

    .maskSpanJoinable {
      background-color: #cccccc;
      text-align: right;
      cursor: pointer;
    }

    .maskSpanRotate {
      filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=1);
      background-color: green;
    }
  </style>
</head>

<body class="global-font">
  <!-- Start of Navigation -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      el_autohide = document.querySelector('.autohide');

      navbar_height = document.querySelector('.navbar').offsetHeight;
      document.body.style.paddingTop = navbar_height + 'px';

      if (el_autohide) {
        var last_scroll_top = 0;
        window.addEventListener('scroll', function () {
          let scroll_top = window.scrollY;
          if (scroll_top < last_scroll_top) {
            el_autohide.classList.remove('scrolled-down');
            el_autohide.classList.add('scrolled-up');
          }
          else {
            el_autohide.classList.remove('scrolled-up');
            el_autohide.classList.add('scrolled-down');
          }
          last_scroll_top = scroll_top;
        });
      }

    }); 
  </script>
  <nav class="autohide navbar navbar-expand-lg bg-black text-white scrolled-up navbar-dark bg-dark">
    <div class="container">
      <div class="d-flex flex-grow-1 justify-content-start">
        <a class="navbar-brand" href="https://www.prodyna.com/">
          <img
            src="https://uploads-ssl.webflow.com/6267a1f7a8182aa6e6312ff3/62e2654e8f998c0b17f2e2c3_prodyna%20logo.svg"
            loading="lazy" alt="prodyna company logo" class="nav-logo">
        </a>
      </div>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent"></div>
    </div>
  </nav>
  <!-- End of Navigation -->

  <div class="container mt-5 mb-5 pt-4 pb-4 global-main">
    <div class="row">
      <div class="import-export">
        <button onclick="download()">Export</button>
        <button onclick="upload()">Import</button>
        <input type="file" accept=".txt" onchange="handleFiles()" id="import-file" name="import-file" style="display: none;" />
        <script>
          function upload() {
            document.getElementById("import-file").click();
          }

          function handleFiles() {
            const [file] = document.getElementById("import-file").files;
            const reader = new FileReader();

            reader.addEventListener(
              "load",
              () => {
                s = reader.result.split(';');

                if (s.length === 3) {
                  window.open('subnets.html?network=' + s[0] + '&mask=' + s[1] + '&division=' + s[2], "_self");
                } else {
                  alert("Wrong file!");
                }
              },
              false,
            );

            if (file) {
              reader.readAsText(file);
            } else {
              alert("Wrong file format detected in your upload process!");
            }
          }

          function download() {
            var element = document.createElement('a');
            var text = inet_ntoa(curNetwork) + ';' + curMask + ';' + binToAscii(nodeToString(rootSubnet));
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', 'network=' + inet_ntoa(curNetwork) + '&mask=' + curMask + '&division=' + binToAscii(nodeToString(rootSubnet)) + '.txt' );

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
          }
        </script>
      </div>
      <table width="100%" class="global-font">
        <tr valign=top>
          <td>

            <h1>Subnet Calculator</h1>

            <p>Enter the network you wish to subnet:</p>

            <form name="calc" onsubmit="updateNetwork(); return false;">

              <table cellspacing="0" class="global-font">
                <tr>
                  <td class="label">Network Address</td>
                  <td class="label">Mask bits</td>
                </tr>
                <tr>
                  <td><input type="text" name="network" size="15" maxlength="15" value="192.168.0.0"></td>
                  <td>/<input type="text" name="netbits" size="2" maxlength="2" value="16"></td>
                  <td><input type="submit" value="Update">
                    <input type="button" value="Reset"
                      onclick="if (confirm('This will reset all subnet divisions you have made. Proceed?')) startOver();">
                  </td>
                </tr>
              </table>

              <p class="global-options">Show columns:
                <input type="checkbox" id="cb_subnet" checked onclick="toggleColumn(this)"><label for="cb_subnet">Subnet
                  address</label>
                <input type="checkbox" id="cb_netmask" onclick="toggleColumn(this)"><label
                  for="cb_netmask">Netmask</label>
                <input type="checkbox" id="cb_range" checked onclick="toggleColumn(this)"><label for="cb_range">Range of
                  addresses</label>
                <input type="checkbox" id="cb_useable" checked onclick="toggleColumn(this)"><label
                  for="cb_useable">Useable
                  IPs</label>
                <input type="checkbox" id="cb_hosts" checked onclick="toggleColumn(this)"><label
                  for="cb_hosts">Hosts</label>
                <input type="checkbox" id="cb_divide" checked onclick="toggleColumn(this)"><label
                  for="cb_divide">Divide</label>
                <input type="checkbox" id="cb_join" checked onclick="toggleColumn(this)"><label
                  for="cb_join">Join</label>
              </p>
            </form>

            <p>Click below to split and join subnets.<br>
              If you wish to save this subnetting for later, bookmark <a href="subnets.html" id="saveLink">this
                hyperlink</a>.</p>

            <button class="btn-copy" onclick="prepareTable('copyable')">Copy Table to Markdown</button>
            <script>
              function prepareTable(el){
                var el = document.querySelector('#'+el);
                var md = toMarkdown(el);

                navigator.clipboard.writeText(md);
              }

              function toMarkdown(doc) {
                let s = '| ';

                let thead = doc.querySelector('thead');
                let headcells = thead.querySelectorAll('td:not([style*="display:none"]):not([style*="display: none"]), th:not([style*="display:none"]):not([style*="display: none"]):not(.hiddenFromCopy)');
                for (let i = 0; i < headcells.length; i++) {
                    let cell = headcells[i];
                    s += cell.textContent.trim() + ' | ';
                }

                s += '\n'

                for (let i = 0; i < headcells.length; i++) {
                    s += '|---------'
                }

                s += '|\n'

                let tbody = doc.querySelector('tbody');
                let trs = tbody.querySelectorAll('tr');
                for (let i = 0; i < trs.length; i++) {
                    s += '| '
                    let tr = trs.item(i);
                    let tds = tr.querySelectorAll('td:not([style*="display:none"]):not([style*="display: none"]):not(.hiddenFromCopy)');
                    for (let j = 0; j < tds.length; j++) {
                        let td = tds.item(j);
                        s += td.textContent.trim() + ' | ';
                    }
                    s += '\n';
                }
                return s;
              }
            </script>
          </td>
        </tr>
      </table>

      <br>
      <hr noshade color="black" size="1">
      <br>

      <table id="copyable" class="calc global-font" cellspacing="0" cellpadding="2">
        <thead class="text-black">
          <tr>
            <th id="subnetHeader">Subnet address</th>
            <th id="netmaskHeader">Netmask</th>
            <th id="rangeHeader">Range of addresses</th>
            <th id="useableHeader">Useable IPs</th>
            <th id="hostsHeader">Hosts</th>
            <th id="divideHeader" class="hiddenFromCopy">Divide</th>
            <th id="joinHeader" class="hiddenFromCopy">Join</th>
          </tr>
        </thead>
        <tbody id="calcbody"></tbody>
      </table>
      <input type="textarea" style="display: none;" id="table-hidden" />
    </div>
  </div>

  <!-- Start of Footer -->

  <footer class="py-5 mt-5 global-font bg-black text-white">
    <div class="container">
      <div class="global-footer-divider"></div>
      <div class="row">
        <div class="float-start">
          © PRODYNA 2023
          <a href="https://www.prodyna.com/imprint-and-data-policy">Imprint</a>
          <a href="https://www.prodyna.com/imprint-and-data-policy#data-protection">Data Privacy</a>
          <a href="https://www.prodyna.com/contact">Contact</a>
        </div>
      </div>
      <div class="row mb-5">
        <div>
          <div class="float-end">
            <a href="https://www.facebook.com/PRODYNA/" target="_blank">
              <img
                src="https://uploads-ssl.webflow.com/6267a1f7a8182aa6e6312ff3/62c837584815d97a03859d8a_carbon_logo-facebook.png"
                loading="lazy" alt="facebook icon" class="social-icon">
            </a>
            <a href="https://twitter.com/prodynase" target="_blank">
              <img
                src="https://uploads-ssl.webflow.com/6267a1f7a8182aa6e6312ff3/62c83758083b43dbd795d95d_carbon_logo-twitter.png"
                loading="lazy" alt="twitter icon" class="social-icon">
            </a>
            <a href="https://www.instagram.com/prodyna_corporate/" target="_blank">
              <img
                src="https://uploads-ssl.webflow.com/6267a1f7a8182aa6e6312ff3/62c8375806b896887827e209_carbon_logo-instagram.png"
                loading="lazy" alt="instagram icon" class="social-icon">
            </a>
            <a href="https://www.youtube.com/@prodyna684" target="_blank">
              <img
                src="https://uploads-ssl.webflow.com/6267a1f7a8182aa6e6312ff3/62c837588a842d2cf67d0c77_carbon_logo-youtube.png"
                loading="lazy" alt="youtube icon" class="social-icon">
            </a>
            <a href="https://www.xing.com/pages/prodynase" target="_blank">
              <img
                src="https://uploads-ssl.webflow.com/6267a1f7a8182aa6e6312ff3/62c83758b46fe226668ad327_carbon_logo-xing.png"
                loading="lazy" alt="carbon icon" class="social-icon">
            </a>
            <a href="https://www.linkedin.com/company/prodyna/" target="_blank">
              <img
                src="https://uploads-ssl.webflow.com/6267a1f7a8182aa6e6312ff3/62c83758f31a3982e03fc5c1_carbon_logo-linkedin.png"
                loading="lazy" alt="linkedin icon" class="social-icon">
            </a>
          </div>
        </div>
      </div>
      <div class="row">
        <div>
          <blockquote class="float-end">
            <p>
              Copyright (c) 2002, 2011, 2018, 2019 David C A Croft
              <a href="https://github.com/davidc/subnets" rel="noreffer"
                target="_blank">https://github.com/davidc/subnets</a>
            </p>
          </blockquote>
        </div>
      </div>
    </div>
  </footer>

  <!-- End of Footer-->

</body>

</html>